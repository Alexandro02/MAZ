---
import { navLinks } from "@/src/utils/nav.config";
import NavHeader from "@/src/components/navs/NavHeader.astro";
import NavDesktop from "@/src/components/navs/NavDesktop.astro";
import NavMobileWhite from "@/src/components/navs/NavMobileWhiteProducts.astro";
---

<nav
  id="main-nav"
  class="w-full h-[15dvh] z-50 flex items-center justify-between text-[12px] px-4 2xl:px-[12rem] lg:px-[4rem] border-b-1 border-b-[#24408d] bg-white text-[#24408d] transition-colors duration-200 ease-in-out"
>
  <NavHeader img="/Logo-MAZ-Azul.png">
    <NavDesktop links={navLinks} />
  </NavHeader>
</nav>

<NavMobileWhite links={navLinks} />

<script is:inline>
  const nav = document.querySelector("#main-nav");
  const btn = document.querySelector("#nav-btn");
  const img = document.querySelector("#nav-img");

  const toggleButton = document.getElementById("menu-toggle");
  const menuIconPath = document.getElementById("menu-icon-path");
  const mobileMenu = document.getElementById("mobile-menu");
  const menuIcon = document.getElementById("menu-icon");

  // ✅ Navbar scroll behavior
  window.addEventListener("scroll", () => {
    if (!nav || !btn || !img) return;

    const scrolled = window.scrollY > 115;

    nav.classList.toggle("fixed", scrolled);
    nav.classList.toggle("top-0", scrolled);
  });

  // ✅ Toggle menú mobile
  toggleButton.addEventListener("click", () => {
    const isOpen = mobileMenu.classList.contains("max-h-[800px]");

    if (!menuIcon || !mobileMenu || !menuIconPath) return;

    menuIcon.setAttribute("stroke", isOpen ? "#fff" : "#24408d");

    if (isOpen) {
      // When closed
      mobileMenu.classList.remove("max-h-[800px]", "opacity-100");
      mobileMenu.classList.add("max-h-0", "opacity-0");

      menuIconPath.setAttribute("d", "M4 8h16M4 16h16");
      document.body.classList.remove("overflow-hidden");
    } else {
      // When open
      mobileMenu.classList.remove("max-h-0", "opacity-0");
      mobileMenu.classList.add("max-h-[800px]", "opacity-100");

      menuIconPath?.setAttribute("d", "M6 18L18 6M6 6l12 12");
      img.setAttribute("src", "/Logo-MAZ-Azul.png");
      document.body.classList.add("overflow-hidden");
    }
  });

  // ✅ Submenús en mobile
  document.querySelectorAll(".submenu-toggle").forEach((toggleBtn) => {
    toggleBtn.addEventListener("click", (e) => {
      const hasSubmenu = toggleBtn.getAttribute("data-has-submenu") === "true";
      const container = toggleBtn.closest("div");
      const submenu = container?.querySelector(".submenu-items");

      if (hasSubmenu && submenu) {
        e.preventDefault();
        submenu.classList.toggle("hidden");
      }
    });
  });

  // ✅ Timeout para submenús desktop (mejora UX)
  const desktopItems = document.querySelectorAll("nav li.group");
  desktopItems.forEach((item) => {
    const submenu = item.querySelector("ul");
    if (!submenu) return;

    let timeoutId;

    item.addEventListener("mouseenter", () => {
      clearTimeout(timeoutId);
      submenu.classList.remove(
        "opacity-0",
        "translate-y-4",
        "pointer-events-none"
      );
      submenu.classList.add(
        "opacity-100",
        "translate-y-0",
        "pointer-events-auto"
      );
    });

    item.addEventListener("mouseleave", () => {
      timeoutId = setTimeout(() => {
        submenu.classList.remove(
          "opacity-100",
          "translate-y-0",
          "pointer-events-auto"
        );
        submenu.classList.add(
          "opacity-0",
          "translate-y-4",
          "pointer-events-none"
        );
      }, 100);
    });
  });
</script>
