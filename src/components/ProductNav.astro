---
const links = [
  {
    link: "Servicios",
    href: "#",
    submenu: [
      { name: "HVAC", href: "/services/hvac" },
      { name: "Instalaciones eléctricas", href: "/services/electric" },
      { name: "Servicios de Ingeniería", href: "/services/engineering" },
    ],
  },
  {
    link: "Productos",
    href: "#",
    submenu: [
      { name: "Todos los Productos", href: "/products" },
      { name: "Chillers", href: "/products/chillers" },
      { name: "Equipos TVR y Tableros", href: "/products/tvr" },
      { name: "Torres de Enfriamiento", href: "/products/cooling" },
      { name: "Equipos Paquete y Div", href: "/products/divpackage" },
      { name: "Bombas Centrífugas", href: "/products/pumps" },
      { name: "Tubería Hidráulica", href: "/products/hidraulic" },
    ],
  },
  { link: "Nosotros", href: "/about-us" },
  { link: "Proyectos", href: "/projects" },
  { link: "Contacto", href: "/contact" },
];
---

<nav
  id="main-nav"
  class="w-full h-[15dvh] z-40 flex items-center justify-between text-[12px] px-4 2xl:px-[12rem] lg:px-[4rem] bg-transparent text-[#22408d] transition-colors duration-200 ease-in-out border-b-1 border-b-[#24408d]"
>
  <a href="/">
    <img id="nav-img" class="w-40 md:w-28 lg:w-40" src="/Logo-MAZ-Azul.png" />
  </a>

  <!-- Botón hamburguesa -->
  <button id="menu-toggle" class="md:hidden focus:outline-none">
    <svg
      id="menu-icon"
      class="w-8 h-8"
      fill="none"
      stroke="currentColor"
      viewBox="0 0 24 24"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        id="menu-icon-path"
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M4 8h16M4 16h16"></path>
    </svg>
  </button>

  <!-- Menú Desktop -->
  <ul class="hidden md:flex md:gap-6 text-[12pt]">
    {
      links.map(({ link, href, submenu }) => (
        <li class="relative group">
          <a href={href} class="flex items-center gap-1">
            {link}
            {submenu && (
              <svg
                class="w-5 h-5"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M19 9l-7 7-7-7"
                />
              </svg>
            )}
          </a>
          {submenu && (
            <ul class="opacity-0 translate-y-4 pointer-events-none transition-all duration-300 ease-in-out absolute left-0 mt-2 bg-white text-[#24408d] rounded-md shadow-lg min-w-[240px] border border-gray-200 z-50 group-hover:opacity-100 group-hover:translate-y-0 group-hover:pointer-events-auto">
              {submenu.map(({ name, href }, i) => (
                <li>
                  <a
                    href={href}
                    class={`block px-4 py-2 ${
                      i === 0 ? "border-b border-gray-300 font-semibold" : ""
                    } hover:bg-[#24408d] hover:rounded-md hover:text-white transition-colors duration-500`}
                  >
                    {name}
                  </a>
                </li>
              ))}
            </ul>
          )}
        </li>
      ))
    }
  </ul>

  <!-- Botón CTA -->
  <button
    id="nav-btn"
    class="hidden md:block bg-[#24408d] px-[15px] py-[8px] rounded-md text-white"
  >
    <a href="#">Cotiza ahora!</a>
  </button>
</nav>

<!-- Menú Mobile -->
<div
  id="mobile-menu"
  class="hidden flex-col md:hidden w-full bg-white text-[#24408d] shadow-md px-4"
>
  <ul class="flex flex-col text-lg">
    {
      links.map(({ link, href, submenu }) => (
        <li class="border-b border-gray-200">
          <div class="flex flex-col">
            <a
              href={href}
              class="flex justify-between items-center px-6 py-4 submenu-link"
              data-has-submenu={submenu ? "true" : "false"}
            >
              {link}
              {submenu && (
                <svg
                  class="w-5 h-5"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  viewBox="0 0 24 24"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M19 9l-7 7-7-7"
                  />
                </svg>
              )}
            </a>
            {submenu && (
              <ul class="hidden flex-col bg-gray-100 submenu-items">
                {submenu.map(({ name, href }) => (
                  <li>
                    <a
                      href={href}
                      class="block px-8 py-2 hover:bg-[#24408d] hover:text-white"
                    >
                      {name}
                    </a>
                  </li>
                ))}
              </ul>
            )}
          </div>
        </li>
      ))
    }
  </ul>
  <div class="p-4">
    <a
      href="#"
      class="block text-center bg-[#24408d] text-white py-2 rounded-md"
    >
      Cotiza ahora!
    </a>
  </div>
</div>

<script>
  const toggleButton = document.getElementById("menu-toggle");
  const menuIconPath = document.getElementById("menu-icon-path");
  const mobileMenu = document.getElementById("mobile-menu");

  toggleButton?.addEventListener("click", () => {
    mobileMenu?.classList.toggle("hidden");
    if (mobileMenu?.classList.contains("hidden")) {
      menuIconPath?.setAttribute("d", "M4 8h16M4 16h16");
    } else {
      menuIconPath?.setAttribute("d", "M6 18L18 6M6 6l12 12");
    }
  });

  const submenuLinks = document.querySelectorAll(".submenu-link");
  submenuLinks.forEach((link) => {
    link.addEventListener("click", (e) => {
      const hasSubmenu = link.getAttribute("data-has-submenu") === "true";
      if (hasSubmenu) {
        e.preventDefault();
        const submenu = link.parentElement?.querySelector(".submenu-items");
        submenu?.classList.toggle("hidden");
      }
    });
  });

  // NUEVO: Manejo con animación suave en submenús desktop
  const desktopSubmenus = document.querySelectorAll(
    "ul.md\\:flex > li.relative"
  );

  desktopSubmenus.forEach((li) => {
    const submenu = li.querySelector("ul");
    let timeout: any;

    if (!submenu) return;

    li.addEventListener("mouseenter", () => {
      submenu.classList.remove(
        "opacity-0",
        "translate-y-4",
        "pointer-events-none"
      );
      submenu.classList.add(
        "opacity-100",
        "translate-y-0",
        "pointer-events-auto"
      );
    });

    li.addEventListener("mouseenter", () => {
      clearTimeout(timeout); // evita cerrar si entras rápido de nuevo
      submenu.classList.remove(
        "opacity-0",
        "translate-y-4",
        "pointer-events-none"
      );
      submenu.classList.add(
        "opacity-100",
        "translate-y-0",
        "pointer-events-auto"
      );
    });

    li.addEventListener("mouseleave", () => {
      timeout = setTimeout(() => {
        submenu.classList.remove(
          "opacity-100",
          "translate-y-0",
          "pointer-events-auto"
        );
        submenu.classList.add(
          "opacity-0",
          "translate-y-4",
          "pointer-events-none"
        );
      }, 200); // puedes ajustar el delay (en ms)
    });
  });
</script>
